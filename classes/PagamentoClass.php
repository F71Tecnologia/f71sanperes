<?phprequire_once("ApiClass.php");class Pagamento{    private $api;    public function __construct() {        $this->api = new ApiClass();    }        function getPagamento($id_regiao) {            $sql = "SELECT *                FROM tipopg                WHERE id_regiao = '{$id_regiao}' AND status_reg = '1'";        $pgt_fin = mysql_query($sql) or die(mysql_error());        return $pgt_fin;    }    function getPagamentoProj($id_regiao,$id_projeto) {        $sql = "SELECT *                FROM tipopg                WHERE id_regiao = '{$id_regiao}' AND id_projeto = '{$id_projeto}' AND status_reg = '1'";        $pgt_fin = mysql_query($sql) or die(mysql_error());        return $pgt_fin;    }    function getPagamentoID($id_pagamento) {        $sql = "SELECT *                FROM tipopg                WHERE status_reg = '1' AND id_tipopg = '{$id_pagamento}'";        $pgt = mysql_query($sql) or die(mysql_error());        $row = mysql_fetch_assoc($pgt);        return $row;    }    function delPagamento($id_pagamento){                        $local = "Excluso de Tipo de Pagamento";        $ip = $_SERVER['REMOTE_ADDR'];            $usuario = carregaUsuario();        $user = $usuario['id_funcionario'];                $acao = "{$usuario['nome']} excluiu o tipo de pagamento " . $id_pagamento;        $tipo_usuario = $usuario['tipo_usuario'];        $grupo_usuario = $usuario['grupo_usuario'];        $regiao = $usuario['id_regiao'];        $sql = "UPDATE tipopg SET status_reg = '0' WHERE id_tipopg = '$id_pagamento'";        $qry = mysql_query($sql);        $res = mysql_fetch_assoc($qry);        $insere_log = mysql_query("INSERT INTO log (id_user, id_regiao, tipo_user, grupo_user, local, horario, ip, acao) VALUES                                            ('{$user}', '{$regiao}', '{$tipo_usuario}', '{$grupo_usuario}', '{$local}', NOW(), '{$ip}', '{$acao}')") or die(mysql_error());            if($insere_log && $qry){            return true;        }else{            return false;        }       }    function cadPagamento() {        $usuario = carregaUsuario();        $id_regiao = $usuario['id_regiao'];        $tipopg = $_REQUEST['tipopg'];        $projeto = $_REQUEST['projeto'];        $num = ($tipopg == "Depsito em Conta Corrente") ? "1" : "2";        $insere_pagamento = mysql_query("INSERT INTO tipopg(id_regiao,id_projeto,tipopg,campo1) VALUES ('{$id_regiao}','{$projeto}','{$tipopg}','{$num}')") or die(mysql_error());        //dados usuario para cadastro de log        $local = "Cadastro de Tipo de Pagamento";        $ip = $_SERVER['REMOTE_ADDR'];        $acao = "{$usuario['nome']} cadastrou o tipo de pagamento {$tipopg}";        $id_usuario = $usuario['id_funcionario'];        $tipo_usuario = $usuario['tipo_usuario'];        $grupo_usuario = $usuario['grupo_usuario'];        $regiao = $usuario['id_regiao'];        $insere_log = mysql_query("INSERT INTO log (id_user, id_regiao, tipo_user, grupo_user, local, horario, ip, acao) VALUES          ('{$id_usuario}', '{$regiao}', '{$tipo_usuario}', '{$grupo_usuario}', '{$local}', NOW(), '{$ip}', '{$acao}')") or die(mysql_error());        if ($insere_pagamento && $insere_log) {            $_SESSION['MESSAGE'] = 'Informaes gravadas com sucesso!';            $_SESSION['MESSAGE_COLOR'] = 'message-blue';            $_SESSION['MESSAGE_TYPE'] = 'info';            $_SESSION['regiao'] = $id_regiao;            $_SESSION['pausa'] = 'pausar';        } else {            $_SESSION['MESSAGE'] = 'Erro ao cadastrar a unidade '.$nome;            $_SESSION['MESSAGE_COLOR'] = 'message-red';            $_SESSION['regiao'] = $id_regiao;            $_SESSION['pausa'] = 'pausar';        }    }    function alteraPagamento() {        $tipopg = $_REQUEST['tipopg'];        $projeto = $_REQUEST['projeto'];        $num = ($tipopg == "Depsito em Conta Corrente") ? "1" : "2";        $id_pagamento = $_REQUEST['id_pagamento'];        //dados usuario para cadastro de log        $usuario = carregaUsuario();        $local = "Alterao de Tipo de Pagamento";        $ip = $_SERVER['REMOTE_ADDR'];        $acao = "{$usuario['nome']} alterou o tipo de pagamento {$id_pagamento}";        $id_usuario = $usuario['id_funcionario'];        $tipo_usuario = $usuario['tipo_usuario'];        $grupo_usuario = $usuario['grupo_usuario'];        $regiao = $usuario['id_regiao'];        $altera_pagamento = mysql_query("UPDATE tipopg SET id_projeto = '{$projeto}',tipopg = '{$tipopg}', campo1 = '{$num}' WHERE id_tipopg = '{$id_pagamento}' LIMIT 1") or die(mysql_error());        $insere_log = mysql_query("INSERT INTO log (id_user, id_regiao, tipo_user, grupo_user, local, horario, ip, acao) VALUES                                    ('{$id_usuario}', '{$regiao}', '{$tipo_usuario}', '{$grupo_usuario}', '{$local}', NOW(), '{$ip}', '{$acao}')") or die(mysql_error());        if ($altera_pagamento && $insere_log) {            $_SESSION['MESSAGE'] = 'Informaes alteradas com sucesso!';            $_SESSION['MESSAGE_COLOR'] = 'message-blue';            $_SESSION['MESSAGE_TYPE'] = 'info';            $_SESSION['regiao'] = $regiao;            $_SESSION['pausa'] = 'pausar';            session_write_close();            header('Location: index.php');        } else {            $_SESSION['MESSAGE'] = 'Erro ao atualizar a unidade';            $_SESSION['MESSAGE_COLOR'] = 'message-red';            $_SESSION['regiao'] = $regiao;            $_SESSION['pausa'] = 'pausar';            session_write_close();            header('Location: index.php');        }    }        public function getEncargosFolha($comp){        $compet = explode('-',$comp);                $_mes = sprintf("%02d", $compet[1]);        $ano = $compet[0];        $query = "SELECT B.id_pg as id, C.cnpj, D.tipo AS descricao, B.mes_pg, A.data_vencimento, A.data_pg,                         SUM(A.valor_multa) as juros,                        SUM(CAST( REPLACE(A.valor, ',', '.') as decimal(13,2))) as valor                   FROM pagamentos AS B                   LEFT JOIN saida AS A ON (A.id_saida = B.id_saida)                   LEFT JOIN rhempresa AS C ON (A.id_regiao = C.id_regiao)                   LEFT JOIN pagamentos_tipo_folha AS D ON (B.tipo_pg = D.id_tipo)                   WHERE B.mes_pg = '{$_mes}' AND B.ano_pg = '{$ano}' AND (A.data_pg IS NOT NULL OR A.data_pg != '0000-00-00')                   GROUP BY B.tipo_pg";                $sql = mysql_query($query) or die(mysql_error());        if(WEBSERVICE === true){            $saida = $this->api->montaRetorno($sql);        }        return $saida;    }    }?>