<?php error_reporting(E_ALL);session_start();if (empty($_COOKIE['logado'])) {    print "<script>location.href = '../../login.php?entre=true';</script>";}include("../../conn.php");include("../../wfunction.php");include("../../funcoes.php");include("../../classes/BotoesClass.php");include("../../classes/EntradaClass.php");include("../../classes/SaidaClass.php");include("../../classes/global.php");$usuario = carregaUsuario();$container_full = true;$dadosHeader = montaCabecalhoNovo(getRegioes(), getMasters(), $usuario, __FILE__); //PREPARA VARIAVEIS PARA FUNCIONAMENTO DO CABEÇALHO (TROCA DE MASTER E DE REGIÕES)$regiao_sel = $usuario['id_regiao'];$arraySaidaRh = array(168, 167, 169, 170, 156, 154, 29, 30, 31, 32, 260, 171); //array(29, 30, 31, 32, 51, 76, 154, 156, 167, 168, 169, 170, 171, 175, 260);                $entrada = new Entrada();$saida = new Saida();$global = new GlobalClass();if(isset($_REQUEST['filtrar'])){        $chkSaida = $chkEntrada = 0;    if(empty($_REQUEST['chk'])) {        $chkSaida = 1;        $chkEntrada = 1;    }        if(in_array(1, $_REQUEST['chk'])) {        $chkSaida = 1;    }        if(in_array(2, $_REQUEST['chk'])) {        $chkEntrada = 1;    }            $filtro = true;    if($chkEntrada) {        $result_entrada = $entrada->getEntradaRel($usuario['id_regiao']);        $total_entrada = mysql_num_rows($result_entrada);    $arrayEntradaFiles = $entrada->getArquivos2($usuario['id_regiao']);    }    if($chkSaida) {        $result_saida = $saida->getSaidaRel();        $total_saida = mysql_num_rows($result_saida);    }    }if(isset($_REQUEST['gerar'])){    $gerar = true;    $result_lancamento = $saida->getLancamento();    $total_lancamento = mysql_num_rows($result_lancamento);}/* VARIAVEIS PARA MANTER OS CAMPOS DO FORMULÁRIO SELECIONADO */$bancoR = (isset($_REQUEST['banco'])) ? $_REQUEST['banco'] : $_SESSION['banco'];if(isset($_REQUEST['mes'])){    $mesR = $_REQUEST['mes'];}elseif(isset($_SESSION['mes'])){    $mesR = $_SESSION['mes'];}else{    $mesR = date('m');}if(isset($_REQUEST['ano'])){    $anoR = $_REQUEST['ano'];}elseif(isset($_SESSION['ano'])){    $anoR = $_SESSION['ano'];}else{    $anoR = date('Y');}$projetoR = $_REQUEST['projeto'];$lancamento = $_REQUEST['lancamento'];$breadcrumb_config = array("nivel"=>"../", "key_btn"=>"4", "area"=>"Financeiro", "id_form"=>"form1", "ativo"=>"Relatório de Entradas e Saídas");$breadcrumb_pages = array("Principal" => "../index.php");?><!DOCTYPE html><html lang="pt">    <head>        <meta charset="iso-8859-1">        <meta http-equiv="X-UA-Compatible" content="IE=edge">        <meta name="viewport" content="width=device-width, initial-scale=1">        <title>:: Intranet :: Relatório de Entradas e Saídas</title>        <link href="../../favicon.png" rel="shortcut icon" />        <!-- Bootstrap -->        <link href="../../resources/css/bootstrap.css" rel="stylesheet" media="all">        <link href="../../resources/css/bootstrap-theme.css" rel="stylesheet" media="all">        <link href="../../resources/css/bootstrap-note.css" rel="stylesheet" media="all">        <link href="../../resources/css/ui-datepicker-theme.css" rel="stylesheet" media="all">        <link href="../../resources/css/main.css" rel="stylesheet" media="all">        <link href="../../resources/css/font-awesome.css" rel="stylesheet" media="all">        <link href="../../resources/dropzone/dropzone.css" rel="stylesheet" media="all">        <link href="../../resources/css/bootstrap-dialog.min.css" rel="stylesheet" type="text/css">        <link href="../../css/validationEngine.jquery.css" rel="stylesheet" type="text/css" />    </head>    <body>        <?php include("../../template/navbar_default.php"); ?>                <div class="<?=($container_full) ? 'container-full' : 'container'?>">            <div class="page-header box-financeiro-header"><h2><span class="glyphicon glyphicon-usd"></span> - Financeiro<small> - Relatório de Entradas e Saídas</small></h2></div>                                            <!--resposta de algum metodo realizado-->                <!--<?php echo $global->getResposta($_SESSION['MESSAGE_TYPE'], $_SESSION['MESSAGE']); ?>-->                                <fieldset class="hidden-print">                    <legend>Relatório de Entradas e Saídas</legend>                        <div class="col-md-6 no-padding-l">                        <div class="panel panel-default">                            <form action="" method="post" class="form-horizontal top-margin1" name="form2" id="form2">                                <div class="panel-body">                                    <div class="form-group">                                        <label for="select" class="col-md-2 control-label">Projeto</label>                                        <div class="col-md-10">                                            <?php echo montaSelect(getProjetos($regiao_sel), $projetoR, "id='projeto' name='projeto' class='form-control validate[required,custom[select]]'"); ?>                                        </div>                                    </div>                                    <div class="form-group">                                        <!--<label for="select" class="col-md-2 control-label">Visualizar</label>-->                                        <div class="col-md-6">                                            <div class="input-group">                                                <div class="input-group-addon">                                                    <input type="radio" name="lancamento" id="lancamento" class="validate[required]" value="1" <?php if($lancamento == 1){ echo "checked"; } ?> />                                                </div>                                                <div type="text" class="form-control">Lançamentos não pagos</div>                                            </div>                                        </div>                                        <div class="col-md-6">                                            <div class="input-group">                                                <div class="input-group-addon">                                                    <input type="radio" name="lancamento" id="lancamento" class="validate[required]" value="2" <?php if($lancamento == 2){ echo "checked"; } ?> />                                                </div>                                                <div type="text" class="form-control">Lançamentos futuros</div>                                            </div>                                        </div>                                    </div>                                </div>                                <div class="panel-footer text-right">                                    <input type="submit" name="gerar" id="ger" value="Gerar" class="btn btn-primary" />                                </div>                            </form>                        </div>                    </div>                    <div class="col-md-6 no-padding-r">                        <div class="panel panel-default">                            <form action="" method="post" class="form-horizontal top-margin1" name="form1" id="form1">                                <div class="panel-body">                                    <div class="form-group">                                        <label for="select" class="col-md-2 control-label">Conta</label>                                        <div class="col-md-10">                                            <?php echo montaSelect($global->carregaBancosByRegiao($usuario['id_regiao'], array("todos" => "Todas as Contas"), 1), $bancoR, "id='banco' name='banco' class='required[custom[select]] form-control'"); ?>                                        </div>                                    </div>                                    <div class="form-group">                                        <label for="select" class="col-md-2 control-label">Mês</label>                                        <div class="col-md-10">                                            <div class="input-daterange input-group" id="bs-datepicker-range">                                                <?php echo montaSelect(mesesArray(),$mesR, "id='mes' name='mes' class='validate[required,custom[select]] form-control'"); ?>                                                <span class="input-group-addon">Ano</span>                                                <?php echo montaSelect(AnosArray(2008,null),$anoR, "id='ano' name='ano' class='form-control'"); ?>                                            </div>                                        </div>                                    </div>                                    <div class="form-group">                                    <div class="col-sm-offset-2 col-sm-10">                                        <!--<label for="" class="control-label">Agrupamento</label>-->                                        <div class="input-group">                                            <label class="input-group-addon" for="chkSaida"><input type="checkbox" name="chk[]" id="chkSaida" value="1" <?php echo (empty($_REQUEST['chk']) || in_array(1, $_REQUEST['chk'])) ? 'CHECKED' : null ?>></label>                                            <label class="form-control" for="chkSaida">Saída</label>                                            <label class="input-group-addon" for="chkEntrada"><input type="checkbox" name="chk[]" id="chkEntrada" value="2" <?php echo (empty($_REQUEST['chk']) || in_array(2, $_REQUEST['chk'])) ? 'CHECKED' : null ?>></label>                                            <label class="form-control" for="chkEntrada">Entrada</label>                                        </div>                                    </div>                                </div>                                </div>                                <div class="panel-footer text-right">                                    <input type="submit" name="filtrar" id="filt" value="Gerar" class="btn btn-primary" />                                                                <input type="hidden" name="hide_regiao" id="hide_regiao" value="<?php echo $projetoR; ?>" />                                                                   <input type="hidden" name="entrada" id="entrada" value="" />                                    <input type="hidden" name="id_saida" id="saida" value="" />                                </div>                            </form>                        </div>                    </div>                </fieldset>                                                           <?php            if ($filtro) {                if ($total_entrada > 0) { ?>                        <table class='table table-bordered table-hover table-striped table-condensed text-sm valign-middle'>                <thead>                    <tr>                        <th colspan="11" class="text-center active">Controle de Entradas</th>                    </tr>                    <tr class="bg-primary">                        <th>Cód.</th>                        <th>Data</th>                        <th>Nome do Crédito</th>                        <th>Conta Creditada</th>                        <th>Tipo de Entrada</th>                        <th>Descrição</th>                        <th>Cad. por</th>                        <th>Nº</th>                        <th>Valor Total</th>                        <th class="text-center text-info hidden-print"><i class="fa fa-paperclip"></i></th>                        <th class="text-center text-warning hidden-print"><i class="fa fa-pencil"></i></th>                    </tr>                </thead>                <tbody>                    <?php while ($row_entrada = mysql_fetch_assoc($result_entrada)) { ?>                    <tr>                        <td><?php echo $row_entrada['id_entrada']; ?></td>                        <td><?php echo $row_entrada['data_vencimento']; ?></td>                        <td><?php echo $row_entrada['entrada_nome']; ?></td>                        <td><?php echo "AG: {$row_entrada['banco_agencia']} / C: {$row_entrada['banco_conta']}"; ?></td>                        <td><?php echo $row_entrada['tipo_entrada']; ?></td>                        <td><?php echo $row_entrada['especifica']; ?></td>                        <td><?php echo $row_entrada['func_nome']; ?></td>                        <td><?php echo $row_entrada['numero_doc']; ?></td>                        <td><?= formataMoeda($row_entrada['valor_nf']); ?></td>                        <td class="text-center hidden-print">                            <?php//                            $qr_notas = $entrada->getArquivos(null, $row_entrada['id_entrada']);//                            $rs_notas = mysql_fetch_assoc($qr_notas);//                            $tt_notas = mysql_num_rows($qr_notas);                                                        //if($row_entrada['tipo'] == 12 && $tt_notas > 0){                            if($row_entrada['tipo'] == 12 && count($arrayEntradaFiles[$row_entrada['id_entrada']]) > 0){ ?>                                <a href="javascript:;" class="ver_entrada_file" data-entrada="<?php echo $row_entrada['id_entrada']; ?>"><i class="fa fa-paperclip"></i></a>                            <?php } ?>                        </td>                                                <td class="text-center hidden-print"><a href="javascript:;" class="bt-image btn btn-xs btn-warning" data-action="editar" data-target="_blank" data-type="entrada" data-key="<?=$row_entrada['id_entrada']?>"><i title="Editar" class="fa fa-pencil"></i></a></td>                    </tr>                                        <?php                    $valor_soma     = str_replace(",",".",$row_entrada['valor']);                    $adicional      = str_replace(",",".",$row_entrada['adicional']);                                        $valor_total1 = $valor_total1 + $valor_soma + $adicional;                    ?>                                        <?php } ?>                    <tr>                        <td colspan="11" class="warning text-right">                            TOTAL DE ENTRADAS: <?php echo "<strong> " . formataMoeda($valor_total1) . "</strong>"; ?>                        </td>                    </tr>                </tbody>            </table>            <?php } ?>                        <div class="clear"></div>                        <?php if($total_saida > 0){ ?>            <table class='table table-bordered table-hover table-striped table-condensed text-sm valign-middle'>                <thead>                    <tr>                        <th colspan="17" class="text-center active">Controle de Saídas</th>                    </tr>                    <tr class="bg-primary">                        <th>Cód.</th>                        <th>Data</th>                        <th>Nome do Crédito</th>                        <th>Conta Debitada</th>                        <th>Tipo de Saída</th>                        <th>Grupo</th>                        <!--<th>Subgrupo</th>-->                        <th>Descrição</th>                        <th>Cad. por</th>                        <th>Editado por</th>                        <th>Pago por</th>                        <!--<th class="hidden-print">Valor Adicional</th>-->                        <th>N Nota</th>                        <th>N Borderô</th>                        <th>Cheque Borderô</th>                        <th>Valor Total</th>                        <th class="text-center hidden-print"><i class="fa fa-paperclip"></i></th>                        <th class="text-center text-warning hidden-print"><i class="fa fa-pencil"></i></th>                        <th class="text-center text-warning hidden-print"> </th>                    </tr>                </thead>                <tbody>                    <?php while ($row_saida = mysql_fetch_assoc($result_saida)) { ?>                    <tr style="font-size: 10px;">                        <td><?php echo $row_saida['id_saida']; ?></td>                        <td><?php echo $row_saida['data_vencimento']; ?></td>                        <td width="150px"><?php echo $row_saida['saida_nome']; ?></td>                        <td><?php echo "AG: {$row_saida['banco_agencia']} / C: {$row_saida['banco_conta']}"; ?></td>                        <td><?php echo $row_saida['tipo_saida']; ?></td>                        <td><?php echo $row_saida['grupo_saida']; ?></td>                        <!--<td><?php echo $row_saida['subgrupo_saida']; ?></td>-->                        <td width="250px"><?php echo ($row_saida['tipo'] == 155) ? $row_saida['especifica']." (13º)" : $row_saida['especifica']; ?></td>                        <td><?php echo $row_saida['func_nome']; ?></td>                        <td><?php echo $row_saida['func_editou']; ?></td>                        <td><?php echo $row_saida['funcpg_nome']; ?></td>                        <td><?php echo $row_saida['n_documento']; ?></td>                        <td><?php echo $row_saida['id_bordero']; ?></td>                        <td><?php echo $row_saida['numero_cheque']; ?></td>                        <!--<td class="hidden-print"><?php echo ($row_saida['saida_adicional'] == 0) ? "-" : formataMoeda($row_saida['saida_adicional']); ?></td>-->                        <td><?= formataMoeda($row_saida['valor_nf']); ?></td>                                                <td class="text-center hidden-print">                            <?php                                                                                     //link direto, caso seja rescisão                            if($row_saida['tipo'] == 170){                                $rescisao = $saida->verificaSaidaRescisao($row_saida['id_saida']);                                $ttl_file = 1;                            }else{                                                            $qry_file = $saida->getSaidaFile($row_saida['id_saida']);                                $rst_file = mysql_fetch_assoc($qry_file);                                $ttl_file = mysql_num_rows($qry_file);                                $qry_file_pg = $saida->getSaidaFilePg($row_saida['id_saida']);                                $rst_file_pg = mysql_fetch_assoc($qry_file_pg);                                $ttl_file_pg = mysql_num_rows($qry_file_pg);                                                            }                            if($ttl_file > 0){ ?>                                <a title="Comprovante" class="margin_r5 comprovante" data-rescisao="<?php echo $rescisao; ?>" data-type="file" data-key="<?php echo $row_saida['id_saida']; ?>" href="javascript:;"><i class="fa fa-paperclip text-info"></i></a>                            <?php }                                                        if($ttl_file_pg > 0){ ?>                                <a title="Comprovante de Pagamento" class="margin_r5 comprovante" data-type="file_pg" data-key="<?php echo $row_saida['id_saida']; ?>" href="javascript:;"><i class="fa fa-paperclip text-info"></i></a>                            <?php } ?>                        </td>                                                <td class="text-center hidden-print">                            <a href="javascript:;" class="bt-image btn btn-xs btn-warning" data-action="saida<?=(in_array($row_saida['tipo'], $arraySaidaRh)) ? '_rh' : ''?>" data-target="_blank" data-type="saida" data-key="<?=$row_saida['id_saida']?>">                                <i title="Editar" class="fa fa-pencil"></i>                            </a>                        </td>                        <td class="text-center hidden-print">                            <?php if($row_saida['id_saida']==16){?>                            <a href="javascript:;" class="bt-image btn btn-xs disabled">                                <i title="ENVIADO!" class="fa fa-flag"></i>                            </a>                            <?php }else{ ?>                            <a href="javascript:;" class="bt-image btn btn-xs btn-success">                                <i title="Enviar SIPEF" class="fa fa-paper-plane"></i>                            </a>                            <?php } ?>                        </td>                    </tr>                                        <?php                    $valor_somaS    = str_replace(",",".",$row_saida['valor']);                    $adicionalS     = str_replace(",",".",$row_saida['adicional']);                    $mutaS          = str_replace(",",".",$row_saida['valor_multa']);                    $jurosS         = str_replace(",",".",$row_saida['valor_juros']);                                        $valor_total1S = $valor_total1S + $valor_somaS + $adicionalS;                    $rescisao = null;                    $ttl_file = null;                    ?>                                        <?php } ?>                    <tr>                        <td colspan="17" class="warning text-right">                            TOTAL DE SAÍDAS: <?php echo "<strong> " . formataMoeda($valor_total1S) . "</strong>"; ?>                        </td>                    </tr>                </tbody>            </table>                        <?php            }                //calculo de subtração dos totais                                $calc = $valor_total1 - $valor_total1S;                                                ?>                        <?php if($total_entrada > 0 && $total_saida > 0) { ?>            <div class="alert alert-dismissable alert-info col-md-6 pull-right text-right">                                TOTAL: <?php echo "<strong> " . formataMoeda($calc) . "</strong>"; ?>            </div>            <?php } ?>                        <div class="clear"></div>                        <?php if($total_entrada <= 0 && $total_saida <= 0) { ?>                <div class="alert alert-danger top30">                    Nenhum registro encontrado                </div>            <?php }            } ?>                        <!--LANÇAMENTOS-->                        <?php            if ($gerar) {                if ($total_lancamento > 0) {            ?>                        <table class='table table-bordered table-hover table-striped table-condensed text-sm valign-middle'>                <thead>                    <tr>                        <th colspan="14" class="text-center active">Controle de Saídas</th>                    </tr>                    <tr class="bg-primary">                        <th>Cód.</th>                        <th>Data de Recebimento</th>                        <th>Nome do Crédito</th>                        <th>Conta Debitada</th>                        <th>Tipo de Saída</th>                        <th>Grupo</th>                        <th>Descrição</th>                        <th>Cad. por</th>                        <!--<th class="hidden-print">Valor Adicional</th>-->                        <th>Valor Total</th>                        <th class="hidden-print"><i class="fa fa-paperclip"></i></th>                        <th class="hidden-print"><img src="../../imagens/icones/icon-edit.gif" class="pb" /></th>                    </tr>                </thead>                <tbody>                    <?php while ($row_lancamento = mysql_fetch_assoc($result_lancamento)) { ?>                    <tr>                        <td><?php echo $row_lancamento['saida_id']; ?></td>                        <td><?php echo $row_lancamento['saida_vencimento']; ?></td>                        <td><?php echo $row_lancamento['saida_nome']; ?></td>                        <td><?php echo "AG: {$row_lancamento['banco_agencia']} / C: {$row_lancamento['banco_agencia']}"; ?></td>                        <td><?php echo $row_lancamento['entsai_nome']; ?></td>                        <td><?php echo $row_lancamento['grupo_nome']; ?></td>                        <td><?php echo $row_lancamento['saida_especifica']; ?></td>                        <td><?php echo $row_lancamento['func_nome']; ?></td>                        <!--<td class="hidden-print"><?php echo ($row_lancamento['saida_adicional'] == 0) ? "-" : formataMoeda($row_lancamento['saida_adicional']); ?></td>-->                        <td><?php echo formataMoeda($row_lancamento['saida_valor'] + $row_lancamento['valor_multa'] + $row_lancamento['valor_juros']); ?></td>                        <td class="center hidden-print">                            <?php                            //link direto, caso seja rescisão                            if($row_lancamento['tipo'] == 170){                                $rescisao = $saida->verificaSaidaRescisao($row_lancamento['saida_id']);                                $ttl_file = 1;                            }else{                                                            $qry_file = $saida->getSaidaFile($row_lancamento['saida_id']);                                $rst_file = mysql_fetch_assoc($qry_file);                                $ttl_file = mysql_num_rows($qry_file);                                $qry_file_pg = $saida->getSaidaFilePg($row_lancamento['saida_id']);                                $rst_file_pg = mysql_fetch_assoc($qry_file_pg);                                $ttl_file_pg = mysql_num_rows($qry_file_pg);                                                            }                            if($ttl_file > 0){ ?>                            <a title="Comprovante" class="margin_r5 comprovante" data-rescisao="<?php echo $rescisao; ?>" data-type="file" data-key="<?php echo $row_lancamento['saida_id']; ?>" href="javascript:;"><img src="../../imagens/icones/icon-anexo.png"  /></a>                            <?php }                                                        if($ttl_file_pg > 0){ ?>                                <a title="Comprovante de Pagamento" class="margin_r5 comprovante" data-type="file_pg" data-key="<?php echo $row_lancamento['saida_id']; ?>" href="javascript:;"><img src="../../imagens/icones/icon-anexo.png"  /></a>                            <?php } ?>                        </td>                                                <td class="center hidden-print">                            <img src="../../imagens/icones/icon-edit.gif" title="Editar" class="bt-image" data-action="saida<?=(in_array($row_lancamento['tipo'], $arraySaidaRh)) ? '_rh' : ''?>" data-type="saida" data-key="<?php echo $row_lancamento['saida_id']; ?>" data-target="_blank" />                        </td>                                            </tr>                                        <?php                    $valor_somaS = str_replace(",",".",$row_lancamento['saida_valor']);                    $adicionalS = str_replace(",",".",$row_lancamento['saida_adicional']);                                        $valor_total1S = $valor_total1S + $valor_somaS + $adicionalS;                    ?>                                        <?php } ?>                    <tr>                        <td colspan="14" class="warning text-right">                            TOTAL DE SAÍDAS: <?php echo "<strong> " . formataMoeda($valor_total1S) . "</strong>"; ?>                        </td>                    </tr>                </tbody>            </table>                        <?php }else{ ?>                <div class="alert alert-danger top30">                    Nenhum registro encontrado                </div>            <?php }            } ?>                        <?php include('../../template/footer.php'); ?>        </div>                <script src="../../js/jquery-1.10.2.min.js"></script>        <script src="../../js/jquery-ui-1.9.2.custom.min.js"></script>        <script src="../../resources/js/bootstrap.min.js"></script>         <script src="../../resources/js/bootstrap-datepicker.js"></script>        <script src="../../resources/js/bootstrap-dialog.min.js"></script>        <script src="../../resources/js/tooltip.js"></script>        <script src="../../resources/js/main.js"></script>        <script src="../../resources/js/financeiro/entrada.js"></script>        <script src="../../js/global.js"></script>        <script src="../../js/jquery.validationEngine-2.6.js" type="text/javascript"></script>        <script src="../../js/jquery.validationEngine-pt_BR-2.6.js" type="text/javascript"></script>        <script>            $("#form2").validationEngine({promptPosition : "topRight"});        </script>    </body></html>